---

---

<astro-space-bg id="astro-space-bg"></astro-space-bg>
<script>
  const BLOCK_SIZE = 100;
  const DENSITY = 1;
  const INTERVAL = 5;
  const DELAY_FACTOR = 1.5;

  class SpaceBg extends HTMLElement {
    constructor() {
      super();
      const container = document.getElementById("astro-space-bg");
      if (!container) return;

      let w0 = 0;
      let h0 = 0;
      let blocks = { x: 0, y: 0 };
      // let isAddingStars = true;

      addStars();

      function addStars() {
        if (!container) return;

        const w1 = container.clientWidth;
        const h1 = container.clientHeight;
        if (w1 <= w0 && h1 <= h0) {
          return;
        }
        w0 = w1;
        h0 = h1;

        const newBlocks = getNumBlocks(w1, h1);
        if (newBlocks.x <= blocks.x && newBlocks.y <= blocks.y) {
          return;
        }
        // isAddingStars = true;
        const minX = Math.max(0, Math.min(blocks.x - 1, newBlocks.x - 1));
        const minY = Math.max(0, Math.min(blocks.y - 1, newBlocks.y - 1));
        const maxX = Math.max(newBlocks.x, blocks.x);
        const maxY = Math.max(newBlocks.y, blocks.y);
        for (let x = minX; x < maxX; x++) {
          for (let y = minY; y < maxY; y++) {
            for (let i = 0; i < DENSITY; i++) {
              const coords = getCoords(x, y);
              const div = document.createElement("div");
              div.classList.add("astro-space-bg__star");
              div.style.setProperty("--x", `${coords.x}px`);
              div.style.setProperty("--y", `${coords.y}px`);
              div.style.setProperty(
                "--delay",
                `${varyDelay(INTERVAL, DELAY_FACTOR)}s`,
              );
              div.style.setProperty("--duration", `${varyDuration(INTERVAL)}s`);
              container.appendChild(div);
            }
          }
        }
        blocks = newBlocks;
        // isAddingStars = false;
      }
    }
  }
  customElements.define("astro-space-bg", SpaceBg);

  function getNumBlocks(w: number, h: number) {
    return {
      x: Math.ceil(w / BLOCK_SIZE),
      y: Math.ceil(h / BLOCK_SIZE),
    };
  }

  function getCoords(x: number, y: number) {
    const x0 = x * BLOCK_SIZE;
    const y0 = y * BLOCK_SIZE;
    const dX = Math.round(Math.random() * BLOCK_SIZE);
    const dY = Math.round(Math.random() * BLOCK_SIZE);
    return { x: x0 + dX, y: y0 + dY };
  }

  function varyDelay(base: number, factor: number) {
    return Math.random() * base * factor;
  }

  function varyDuration(base: number) {
    const delta = ((Math.random() - 0.5) * base) / 4;
    return delta + base;
  }
</script>
<style is:global>
  @keyframes twinkle {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    25% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(2);
    }
    75% {
      opacity: 1;
      transform: scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(0);
    }
  }

  #astro-space-bg {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    height: 100%;
    background-color: black;
  }

  #astro-space-bg .astro-space-bg__star {
    --x: 0;
    --y: 0;
    --size: 0.125rem;
    --delay: 2s;
    --duration: 20s;
    opacity: 0;
    color: ghostwhite;
    font-size: var(--size);
    width: var(--size);
    height: var(--size);
    max-width: var(--size);
    min-height: var(--size);
    position: absolute;
    top: var(--y);
    left: var(--x);
    animation: twinkle var(--duration) infinite;
    animation-delay: var(--delay);
    transition: all var(--duration) ease;
  }

  #astro-space-bg .astro-space-bg__star::before {
    content: "\02726";
  }
</style>
